<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="author" content="Laurent Leseigneur">
    <meta name="author" content="Emmanuel Duchastenier">


    <title>Agile Grenoble 2017</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/moon.css">

    <!-- for Font icons: -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style> .reveal i.fa { font-family:FontAwesome; font-style: normal; } </style>
</head>
<body>
<div class="reveal">
    <section class="slides">
        <section title="sponsors">
            <img src="images/Agile_Grenoble_2017_Sponsors.webp" width="860" height="620" />
        </section>
        <section title="titre" data-markdown>
            # Obtenir des feedbacks de tous vos personas plus rapidement en s‚Äôappuyant sur Docker
        </section>
        <section title="presentation speakers">
            <h2>Qui sommes nous?</h2>
            <p>Laurent Leseigneur   </p>
            <p>Emmanuel Duchastenier</p>

            <p>R&amp;D<br/>
            <img src="images/logo_with_text.png" width="40%"/>
            </p>
        </section>
        <!-- <section title="intro">
            <h1>Bonitasoft</h1>
            <ul>
                <li>r√®gle N¬∞1 : changer les r√®gles en mode bottom-up</li>
                <li>r√®gle N¬∞2 : ne jamais changer la r√®gle N¬∞1</li>
            </ul>
        </section> -->
        <section title="glossaire">
            <section>
                <h1>Glossaire</h1>
                <h3 class="fragment current-visible">Docker</h3>
                <h3 class="fragment current-visible">Jenkins</h3>
                <h3 class="fragment current-visible">Github</h3>
                <h3 class="fragment current-visible">Pull Request</h3>
                <h3 class="fragment current-visible">Markdown</h3>
                <aside class="notes">
                   sondage bras lev√©s
                </aside>
            </section>
            <section title="Docker" data-markdown>
                ## Docker
                ![docker infrastructure](images/docker_big_picture.png)
            </section>
        </section>

        <section title="Bonitasoft documentation website">
            <section>
                <h2>Cas d'utilisation n¬∞1</h2>

                <h3>site public contenant la <a href="https://documentation.bonitasoft.com">documentation</a> du produit</h3>
                
                <p align="center"><img src="images/Rognntudjuu.jpg">      </p>

            </section>
            <section>
                <div data-markdown>
                    ## Le probl√®me ? la doc
                    * bas√©e sur Drupal personnalis√© par l‚ÄôIT (obscur pour la R&amp;D)
                    * une seule personne met √† jour la doc
                    * versioning compliqu√© (1 copie par version)
                    * mise en production peu fr√©quente (2x/an), et douloureuse
                    * acc√®s utilisateur ferm√© par login
                </div>
                <aside class="notes">
                   1 version de doc par version mineure de bonita (~ 2 par an)
                </aside>
            </section>
            <section>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;On ne se sent pas propri√©taire du contenu de la documentation.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Aucun report facile d‚Äôune modification sur toutes les versions sup√©rieures. L'oubli est fr√©quent.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Pas de flux de v√©rification : pas d'aper√ßu du rendu final avant sa r√©elle publication.</p>
            </section>
            <section data-markdown>
                ![Thinking](images/monkey_thinking.jpeg)
                ## N√©cessit√© de changer le processus
            </section>
            <section data-markdown>
                ## Oui, mais pour qui?
                ![Personas](images/personas.png)
            </section>
            <section>
                <h2>Personas</h2>
                <table>
                  <tr>
                      <td style="padding:0em;border:0px">
                          <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">Richard</h3>
                          L'utilisateur (payant / de la communaut√©) qui lit la doc en ligne. Il est consommateur du contenu.
                        </td>
                      <td width="120px" style="vertical-align:top;border:0px"><img src="images/richard.png"></td>
                  </tr>
             
                    <tr>
                        <td style="padding:0em;border:0px">
                            <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">MANU</h3>Le d√©veloppeur de la R&D qui maintient la doc √† jour. Il est producteur de contenu.
                        </td>
                        <td width="120px" style="vertical-align:top;border:0px"><img src="images/manu.svg" ></td>
                    </tr>
                    <tr>
                        <td style="padding:0em;border:0px">
                            <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">Marielle</h3>
                            Une personne du support client & un consultant qui font face aux clients perdus dans la doc.
                            Ils sont facilitateurs pour am√©liorer la qualit√© du contenu.
                        </td>
                        <td width="120px" style="vertical-align:top;border:0px"><img src="images/marielle.svg" ></td>
                    </tr>
                </table>
                <aside class="notes">
                    Marielle va par exemple ouvrir un bug de doc / proposer un squelette de PR d'am√©lioration d'un page de doc. (Pull Request non-encore d√©finie pour le moment, on y vient. C'est du teasing!)
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Janvier 2016, la documentation passe en Open Source
                    * indexation possible par les moteurs de recherche, suppression du login obligatoire
                    * bookmarks possibles
                    * meilleur moteur de recherche int√©gr√© au site
                </div>
                <aside class="notes">C'est un Choix d'entreprise</aside>
            </section>
            <section>
                <div data-markdown>
                    ## Tout le contenu passe sous Contr√¥le de Version: Github
                    * flux standard de contribution / revue de contenu
                    * √©crit en [markdown](https://fr.wikipedia.org/wiki/Markdown) en remplacement du ~~HTML~~.
                    * Pull Request (PR) exclusivement: norme de d√©veloppement chez Bonitasoft.
                    * la PR peut √™tre revue par Marielle, c'est notre sceau de qualit√©.
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>## Mise en pr√©-production / production automatis√©e</div>
            </section>
            <section>
                <img src="images/doc_PR_flow.png"/>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Et on vit ainsi dans un monde id√©al?
                </div>
                <div class="fragment" data-markdown>### Les effets secondaires</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## S√©paration entre contenu et pr√©sentation
                    Sur une PR: code source, sans rendu final
                    ![Github Diff](images/github_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ... m√™me si on peut voir le diff√©renciel riche
                    ![Github Diff](images/github_rich_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### toute PR d√©clenche une construction
                    sur l'environnement d'int√©gration continue
                    ![Github Diff](images/doc.rd.lan.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    * Le HTML est g√©n√©r√©
                    * le site est publi√© dans un nouveau container
                    ![Github Diff](images/Jenkins_build_result.png)
                </div>
                <aside class="notes" data-markdown>
                    Ce job a 2 fonctions:
                    * g√©n√©rer le contenu en HTML + Javascript ...
                    * publier le contenu
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ### Tout le site est alors consultable
                    ![Github Diff](images/documentation_PR_site.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Github est notifi√© du r√©sultat du build
                    ![Github Diff](images/Github_checks.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Une notification est envoy√©e sur l'outil de messagerie
                    * chaque fois qu'une PR est cr√©√©e ou comment√©e
                    * chaque fois qu'une PR est ferm√©e (accept√©e ou refus√©e)
                    * chaque fois que la CI pousse sur la Pre-Prod / Prod
                    ![Github Diff](images/slack-doc-prod.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Mise en Production
                    Aujourd'hui, mettre en production une nouvelle version, c'est:
                    * merger une PR dans la branche 7.6
                    * attendre 2 minutes
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Richard</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-trophy" aria-hidden="true"></i>
                                    doc √† jour, cycle de correction plus court</p>
                                <p><i class="fa fa-trophy" aria-hidden="true"></i>
                                    une version B√™ta sort avec la doc d√©j√† √©crite</p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px"><img src="images/richard.png"></td>
                        </tr>
                    </table>

                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Marielle / Manu</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-trophy" aria-hidden="true"></i>
                                    cycle tr√®s court de correction et de mise en prod de la doc</p>
                                <p><i class="fa fa-trophy" aria-hidden="true"></i>
                                    historique des modifications accessible √† tous</p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px"><img src="images/marielle.svg">
                                <img src="images/manu.svg"></td>
                        </tr>
                    </table>

                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Manu</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    m√™me cycle de travail que sur du code produit: Java, JS, Groovy, etc‚Ä¶</p>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    report d‚Äôune version sur l‚Äôautre simplifi√©:<br/><code>git merge</code></p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px">
                                <img src="images/manu.svg">
                            </td>
                        </tr>
                    </table>

                </div>
                <aside class="notes" data-markdown>
                    * M√™me si pas de tests automatis√©s type JUnit
                    * Plus d'oubli de report
                </aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Marielle</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    elle s‚Äôest form√©e √† Git et aux Pull Request Github</p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px">
                                <img src="images/marielle.svg">
                            </td>
                        </tr>
                    </table>

                </div>
                <aside class="notes" data-markdown>
                </aside>
            </section>
            <section title="Sous le capot">
                <div data-markdown>## Sous le capot</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### 1 build = 1 site complet
                    * g√©n√©r√© en HTML √† partir des pages .md
                    * pour chaque version du produit
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### D√©clenchement du build des PR
                    * Jenkins Organization plugin
                    * fichier Jenkinsfile commit√© dans le repository Github
                </div>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Rebuild la PR si nouveaux commits compl√©mentaires</p>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Image Docker mise √† jour. Feedbacks tr√®s courts.</p>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Publication dans un container Docker
                    * sur 1 port d√©di√© (num√©ro de la PR)
                    * m√™me cha√Æne de build que la Prod
                    * le container Docker est supprim√© si la PR est ferm√©e
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Performance
                    * PR merg√©e: dispo en prod en moins de 2 minutes
                    * rendu est identique
                    * plus de 370 PR = 370 mises en prod (depuis Janvier 2016)
                </div>
                <aside class="notes">pas de tests automatis√© type JUnit, mais m√™me cycle de W que sur du code source</aside>
            </section>
        </section>

        <section title="Engine tests on all DB vendor">
            <section>
                <h2>Cas d'utilisation n¬∞2</h2>
                <h3>Lancer ses tests d'int√©gration sur diff√©rents types de base de donn√©es</h3>
            </section>
            <section align="center">
                <h3>Bonita doit tourner sur</h3>
                <div>
                    <img src="images/logo-mysql.png" height="200px">
                    <img src="images/logo-postgresql.svg" height="200px" width="200px">
                </div>
                <div>
                    <img src="images/logo-oracle.png" width="200px" height="200px">
                    <img src="images/logo-sqlserver.png" width="256px" height="200px">
                </div>
                <div class="fragment">H2 en mode √©mulation est rapide, mais ne valide pas la compatibilit√© sur les
                    autres DB vendors.
                </div>
            </section>
            <section align="center">
                <h2>Avant</h2>
                <img src="images/old_computer.jpg">

                <aside class="notes" data-markdown>
                    On d√©pendait de serveurs de base de donn√©es qui devaient:
                    * √™tre d√©marr√©s et en bonne sant√©
                    * avoir la bonne configuration
                    * les instances de base de donn√©es / sch√©mas devaient √™tre cr√©√©es avant lancement des tests
                </aside>
            </section>

            <section data-markdown>
                ## Ce qu'on a mis en place
                Utilisation d‚Äôimages docker d√©j√† tun√©es pour les bases de donn√©es support√©es.
            </section>
            <section>
                <div data-markdown>
                    ## Ce qu'on a mis en place
                    La **configuration** est d√©j√† dans l'image
                </div>
<div data-markdown class="fragment">
```bash
#!/bin/bash

#max_prepared_transactions
sed -i "s/^.*max_prepared_transactions\s*=\s*\(.*\)$/max_prepared_transactions = 100/"
"$PGDATA"/postgresql.conf
```

                </div>
                <aside class="notes" data-markdown>
                    Config: support des transactions XA (Oracle),
                    max Prepared statement (PostgreSQL)
                </aside>
            </section>
            <section>
                <div data-markdown>
                ## Ce qu'on a mis en place
                Les **sch√©mas / databases** n√©cessaires sont d√©j√† dans l'image
                Les **users** de connexion sont d√©j√† dans l'image
                </div>
                <div data-markdown class="fragment">

```sql
CREATE ROLE bonita LOGIN PASSWORD 'bpm';

CREATE DATABASE bonita
WITH OWNER = bonita
ENCODING = 'UTF8'
TABLESPACE = pg_default
CONNECTION LIMIT = -1;
```
                </div>
            </section>
            <section>
                <div data-markdown>
                    ## Ce qu'on a mis en place
                    Possibilit√© de pr√©charger des donn√©es √† partir d'un dump

                </div>
                <div data-markdown class="fragment">

```
#!/bin/bash
if [ -f /opt/bonita/dump/bonita.dump ]; then
psql -h localhost -p 5432 -Ubonita bonita < /opt/bonita/dump/bonita.dump
date > /var/lib/postgresql/restore.lastExecution
echo "Database restored"
fi
```
                </div>
                <aside class="notes" data-markdown>
                    Si le fichier est pr√©sent au bon endroit
                </aside>
            </section>
            <section>
                <div data-markdown>A chaque lancement des tests d'int√©gration, on lance un nouveau conteneur Docker
                </div>

                <pre class="fragment"><code class="xml">
<plugin>
    <groupId>io.fabric8</groupId>
    <artifactId>docker-maven-plugin</artifactId>
    <version>0.18.1</version>
</plugin>
</code></pre>
            </section>
            <section>
                <div data-markdown>A chaque lancement des tests d'int√©gration, on lance un nouveau conteneur Docker</div>

<pre class="fragment"><code class="xml">
<configuration>
  <images>
    &lt;image>
      <name>${docker-mysql-image}</name>
      <run>
        <env>
          <MYSQL_ROOT_PASSWORD>root</MYSQL_ROOT_PASSWORD>
        </env>
        <ports>
          <port>db.random.port:3306</port>
        </ports>
      </run>
    &lt;/image>
  </images>
</configuration>
</code></pre>
            </section>
            <section>
                <div data-markdown>
                    ## Comment?
                    * Activation par profils maven (1 profil pour chaque DB vendor)
                    * Idem avec plugin gradle
                </div>
                <aside class="notes" data-markdown>
                    multi base grace aux profils
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Tips: scalabilit√©

                    Le plugin Maven permet de choisir un port al√©atoire. Plus de conflit de ports.

                    ![pigs rushing](images/pig_rush.jpg)
                </div>
                <aside class="notes" data-markdown>
                    Tips = Conseil pratique
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Tips: Healthcheck

                    Docker permet de s'assurer que l'image est up & running avant de lancer les tests

                </div>
                <div data-markdown class="fragment">

```
FROM postgres:9.3
MAINTAINER Laurent Leseigneur <laurent.leseigneur@bonitasoft.com>

# restore dump on startup if dumpfile is present
VOLUME /opt/bonita/dump

COPY 0_init-databases.sql /docker-entrypoint-initdb.d/0_init-databases.sql
COPY 1_set-max_prepared_transactions.sh
/docker-entrypoint-initdb.d/1_set-max_prepared_transactions.sh
COPY 2_restore_dump.sh /docker-entrypoint-initdb.d/2_restore_dump.sh
COPY healthcheck.sh /usr/local/bin/healthcheck.sh

HEALTHCHECK --interval=5s --retries=120 CMD ["/usr/local/bin/healthcheck.sh"]
```
                </div>
                <aside class="notes" data-markdown>
                    * docker fonctionne en couches, image officielle postgres + sur-couche de conf sp√©cifique Bonita
                    * HealthCheck
            * temps de d√©marrage oracle 
                </aside>
            </section>
            <section>
                    <h1>B√©n√©fices</h1>
                    <div class="fragment" align="left"><i class="fa fa-trophy" aria-hidden="true"></i> env. clean avant chaque lancement, plus stable</div>
                    <div class="fragment" align="left"><i class="fa fa-trophy" aria-hidden="true"></i> Entre 20s & 1mn pour avoir une DB up & running</div>
                    <div class="fragment" align="left"><i class="fa fa-trophy" aria-hidden="true"></i> lancement en local pour debugguer</div>
                    <div class="fragment" align="left"><i class="fa fa-trophy" aria-hidden="true"></i> La R&D est compl√®tement autonome</div>
                <aside class="notes" data-markdown>
                C‚Äôest plus rapide que d‚Äôaller voir Jeremy pour lui demander un serveur et l‚Äôinstaller.
                </aside>
            </section>
            <section>
                <div>
                    <h1>Limitations</h1>
                    <i class="fa fa-meh-o" aria-hidden="true"></i> Pas d'image docker pour MS SQL Server (compatible avec bonita).
                    Ces tests tournent toujours "√† l'ancienne".
                </div>
                <aside class="notes" data-markdown>
                    Transactions distribu√©es XA pas support√©es dans l'image docker SQL Server
                    contraintes peu compatible avec une int√©gration continue sur les volumes de stockage
                </aside>
            </section>
        </section>

        <section title="ICI">
            <section>
                <div>
                    <h2>Cas d'utilisation n¬∞3</h2>
                    <h3>ICI</h3>
                    <p>Intelligent Continuous Improvement, ou "am√©lioration continue assist√©e par l'intelligence artificielle".</p>
                    <p>Ce module utilise un algorithme de process-mining pour pr√©dire la dur√©e des instances de processus g√©r√©es par Bonita.</p>
                    <div class="fragment">
                         <ul>
                            <li>Bonita et sa base de donn√©es</li>
                            <li>Elasticsearch</li>
                            <li>add-on ICI</li>
                         </ul>
                    </div>
                </div>
                 <aside class="notes" data-markdown>
                    FIXME: Je propose d'utiliser le mot plugin plut√¥t que add-on, √ßa parlera au plus grand nombre
                </aside>
            </section>

            <section>
                <h2>Personas</h2>
                <table>
                    <tr>
                        <td style="padding:0em;border:0px">
                            <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">Nathalie</h3>
                            Product Owner et ergonome
                        </td>
                        <td width="120px" style="vertical-align:top;border:0px"><img src="images/nath.svg"></td>
                    </tr>

                    <tr>
                        <td style="padding:0em;border:0px">
                            <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">Luis</h3>
                                D√©veloppeur front end de la UI mobile first
                        </td>
                        <td width="120px" style="vertical-align:top;border:0px"><img src="images/luis.png" height="120px"></td>
                    </tr>
                    <tr>
                        <td style="padding:0em;border:0px">
                            <h3 style="margin-top:15px;margin-bottom:0px;padding:0px">Philippe</h3>
                            Sponsor du projet, Product manager
                        </td>
                        <td width="120px" style="vertical-align:top;border:0px"><img src="images/philippe.svg" ></td>
                    </tr>
                </table>
                <aside class="notes">
                    Approche User Centric Design
                </aside>
            </section>
            <section>
                <div>
                    <h2>Nouveau module,<br/> page blanche sur l'infrastructure</h2>

                    <ul>
                        <li>Maven <i class=" fa fa-arrow-right"></i> Gradle & Gradle Wrapper</li>
                        <li>Int√©gration Continue <i class=" fa fa-arrow-right"></i> Jenkinsfile, Organization plugin</li>
                        <li>Test d'int√©gration et end-to-end <i class=" fa fa-arrow-right"></i> Docker</li>
                        <li>D√©ploiement <i class=" fa fa-arrow-right"></i> Docker compose</li>
                    </ul>
                    <p class="fragment"><i class=" fa fa-thumbs-up"></i> l'outil de build, le job √† jouer sur l'Int√©gration
                        Continue et son d√©ploiement sont dans le m√™me repository GIT que le code source</p>

                </div>
                <aside class="notes">
                    le√ßon apprise: on a enlev√© le deploy syst√©matique des PR. content de savoit le faire, mais inutile
                    et consommateur de ressources (8PR ouvertes = 32 container Dockers

                    ports al√©atoires publi√©s en commentaire de la pull requets sur github

                    single place of truth

                    idem exemlples pr√©cedents
                </aside>
            </section>
            <section>
                <div>
                    <h2>Big Picture</h2>

                   <img src="images/schema_ici.png" width="100%">
                </div>
                <aside class="notes">
               big picture

                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Build wrapper ?

                    * la bonne version de l'outil de build incluse dans la conf
                    * build identique localement et sur l'Int√©gration Continue
                    * plus besoin d'installer maven ou gradle
                </div>
                <div data-markdown class="fragment">
                    gradle-wrapper.properties :
                    ```
                    distributionBase=GRADLE_USER_HOME
                    distributionPath=wrapper/dists
                    zipStoreBase=GRADLE_USER_HOME
                    zipStorePath=wrapper/dists
                    distributionUrl=https\://services.gradle.org/distributions/gradle-4.2-bin.zip
                    ```
                </div>
                <aside class="notes">
                   fichier g√©n√©r√©

                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Docker compose

                    * plusieurs conteneurs reli√©s entre eux
                    * sous-r√©seau partag√©
                    * partage de r√©pertoires (volumes)
                    * ordre de d√©marrage selon les d√©pendances

                </div>
                <div data-markdown class="fragment">
                    ```
                    services:
                        tahitiBackup:
                            container_name: ici-tahitiBackup-${BRANCH_NAME}
                            image: registry.rd.lan/bonitasoft/tahiti-postgres:7.5.1
                        bonitaDB:
                            container_name: ici-db-${BRANCH_NAME}
                            image: registry.rd.lan/bonitasoft/postgres-9.3
                            ports:
                                - ${PORT_DB}:5432
                            depends_on:
                                - tahitiBackup
                            volumes_from:
                                - tahitiBackup
                            expose:
                                - 5432
                    ```

                </div>
                <aside class="notes">
                    le√ßon apprise: on a enlev√© le deploy syst√©matique des PR. content de savoit le faire, mais inutile
                    et consommateur de ressources (8PR ouvertes = 32 container Dockers

                    ports al√©atoires publi√©s en commentaire de la pull requets sur github
                </aside>
            </section>
            <section>
                <div>
                    <h2>User Story int√©gr√©e dans le produit</h2>
                    <div class="fragment">
                        <p>Les conteneurs Docker sont d√©ploy√©s</p>
                        <ul>
                            <li>produit livrable</li>
                            <li>base de donn√©es pr√©-remplie</li>
                        </ul>
                    </div>
                    <div data-markdown class="fragment">
                        ```
                        if (isMaster) {
                        stage('üöÄ Deploy') {
                            def deployGroovy = load "infrastructure/deploy.groovy"
                            deployGroovy.deploy([
                                bonita: 18080,
                                ici: 18082,
                                elastic: 19200,
                                database: 15432,
                                kibana: 15601
                                ],
                                currentBranch)
                            }
                        }
                        ```
                    </div>
                </div>
            </section>
            <section>
                <div>
                    <h2>Pull Request en cours de revue</h2>

                    <div class="fragment">
                        <p>Les conteneurs Docker sont d√©ploy√©s</p>
                        <ul>
                            <li>tests utilisateur</li>
                            <li>notification dans github</li>
                            <li>supprim√©s lorsque la PR est ferm√©e</li>

                        </ul>
                    </div>
                    <div class="fragment">
                        <p align="center">
                            <img src="images/buildPR.png">
                        </p>
                    </div>
                </div>
                <aside class="notes">
                    le√ßon apprise: on a enlev√© le deploy syst√©matique des PR. content de savoit le faire, mais inutile
                    et consommateur de ressources (8PR ouvertes = 32 container Dockers

                    ports al√©atoires publi√©s en commentaire de la pull requets sur github
                </aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Nathalie / Luis</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    Tests utilisateur avec la user story incluant un changement d'ergonomie</p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px"><img src="images/nath.svg">
                                <img src="images/luis.png" height="120px"></td>
                        </tr>
                    </table>

                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div>
                    <h2>B√©n√©fices visibles pour nos Personas</h2>
                    <h3>Philippe</h3>
                    <table>
                        <tr>
                            <td>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    la derni√®re version du produit toujours disponible pour une d√©mo</p>
                                <p><i class="fa fa-thumbs-up" aria-hidden="true"></i>
                                    un environnement avec des donn√©es consistantes</p>
                            </td>
                            <td width="120px" style="vertical-align:top;border:0px"><img src="images/philippe.svg">
                        </tr>
                    </table>

                </div>
                <aside class="notes"></aside>
            </section>
        </section>
        <section title="conclusion">
            <section data-markdown>
                ## Les choses √† am√©liorer

                * temps de d√©marrage de certaines base de donn√©es (O....E)
                * monitorer l'espace disque consomm√© par Docker
            </section>
            <section data-markdown>
                ## Le√ßons apprises

                * tout scripter
                * id√©alement dans le m√™me repository
                * utiliser la m√™me version de Docker / Jenkins partout
                * controler le d√©marage avec la commande healthcheck

            </section>


            <section title="R√©f√©rences" data-markdown>
            ## R√©f√©rences

            * Site de la doc Bonita: http://documentation.bonitasoft.com
            * Plugin Maven Docker: [Fabric8](https://maven.fabric8.io/)
            * Plugin Gradle pour Docker: [gradle-docker-plugin](https://github.com/bmuschko/gradle-docker-plugin)
            * Image officielle docker avec des vrais morceaux de [Bonita](https://hub.docker.com/_/bonita/)
            * Cette [pr√©sentation](https://laurentleseigneur.github.io/agile-grenoble-2017/): https://github.com/laurentleseigneur/agile-grenoble-2017</section>

              </section>
        </section>
        <section title="Merci">
            <h2>Merci pour votre attention</h2>
            <p align="center"><img src="images/merci.gif"></p>
        </section>
        <section title="Q&A">
            <div data-markdown>
            ### Questions?
            ### Remarques?
            ![questions?](images/questions.jpg)
            </div>
            <aside class="notes" data-markdown>
                Si vous voulez √©changer avec nous, il nous reste x minutes
            </aside>
        </section>

        <section title="Questions">
            <section>
                <div data-markdown>
                    ## Registry Docker ?

                    Oui, en interne (qui demande une conf sur chaque poste)
                </div>
            </section>
            <section>
                <div data-markdown>
                    ## Volume vs Container pour data?

                    Conainer pour pouvoir les mettre dans le registry
                </div>
            </section>
        </section>
    </section>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

                // custom Bonitasoft:
                // width: "70%",
                // height: "70%",
                // margin: 0,
                // minScale: 1,
                // maxScale: 1,
                // // Si on veut que √ßa autoscroll toutes les 10s. √ßa affiche en plus un bouton Play/Pause et une spinning Wheel pour montrer le temps qui d√©file !
                // autoSlide: 10000,
                // :custom Bonitasoft

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
</script>
</body>
</html>
