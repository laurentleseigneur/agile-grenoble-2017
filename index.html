<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="author" content="Laurent Leseigneur">
    <meta name="author" content="Emmanuel Duchastenier">


    <title>Agile Grenoble 2017</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/bonitasoft.css">

    <!-- for Font icons: -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style> .reveal i.fa { font-family:FontAwesome; font-style: normal; } </style>
</head>
<body>
<div class="reveal">
    <section class="slides">
        <section title="sponsors">
            <img src="images/Agile_Grenoble_2017_Sponsors.webp" width="860" height="620" />
        </section>
        <section title="titre" data-markdown>
            # Obtenir des feedbacks de tous vos personas plus rapidement en s‚Äôappuyant sur Docker
        </section>
        <section title="presentation speakers" data-markdown>
            ### Qui sommes nous?
            Laurent Leseigneur  
            Emmanuel Duchastenier  
            :: d√©veloppeurs @ Bonitasoft
        </section>
        <!-- <section title="intro">
            <h1>Bonitasoft</h1>
            <ul>
                <li>r√®gle N¬∞1 : changer les r√®gles en mode bottom-up</li>
                <li>r√®gle N¬∞2 : ne jamais changer la r√®gle N¬∞1</li>
            </ul>
        </section> -->
        <section title="glossaire">
            <section>
                <h1>Glossaire</h1>
                <h3 class="fragment current-visible">Docker</h3>
                <h3 class="fragment current-visible">Jenkins</h3>
                <h3 class="fragment current-visible">Github</h3>
                <h3 class="fragment current-visible">Pull Request</h3>
                <h3 class="fragment current-visible">Markdown</h3>
                <aside class="notes">
                   sondage bras lev√©s
                </aside>
            </section>
            <section title="Docker" data-markdown>
                ## Docker
                ![docker infrastructure](images/docker_big_picture.png)
            </section>
        </section>

        <section title="Bonitasoft documentation website">
            <section>
                <h2>Cas d'utilisation</h2>

                <p>site public contenant la <a href="https://documentation.bonitasoft.com">documentation</a> du produit</p>
                
                <p align="center"><img src="images/Rognntudjuu.jpg">      </p>

            </section>
            <section>
                <div data-markdown>
                    ## Le probl√®me ? la doc
                    * bas√©e sur Drupal personnalis√© par l‚ÄôIT (obscur pour la R&amp;D)
                    * une seule personne met √† jour la doc
                    * versioning compliqu√© (1 copie par version)
                    * mise en production peu fr√©quente (2x/an), et douloureuse
                    * acc√®s utilisateur ferm√© par login
                </div>
                <aside class="notes">
                   1 version de doc par version mineure de bonita (~ 2 par an)
                </aside>
            </section>
            <section>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;On ne se sent pas propri√©taire du contenu de la documentation.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Aucun report facile d‚Äôune modification sur toutes les versions sup√©rieures. L'oubli est fr√©quent.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Pas de flux de v√©rification : pas d'aper√ßu du rendu final avant sa r√©elle publication.</p>
            </section>
            <section data-markdown>
                ![Thinking](images/monkey_thinking.jpeg)
                ## N√©cessit√© de changer le processus
            </section>
            <section data-markdown>
                ## Oui, mais pour qui?
                ![Personas](images/4_personas.jpg)
            </section>
            <section>
                <div data-markdown>
                ## Personas
                ### Richard
                L'utilisateur (payant / de la communaut√©) qui lit la doc en ligne. Il est consommateur du contenu.
                ### Manu
                Le d√©veloppeur de la R&D qui maintient la doc √† jour. Il est producteur de contenu.
                ### J√©r√¥me
                Une personne du support client & un consultant qui font face aux clients perdus dans la doc. Ils sont facilitateurs pour am√©liorer la qualit√© du contenu.
                </div>
                <aside class="notes">
                    J√©r√¥me va par exemple ouvrir un bug de doc / proposer un squelette de PR d'am√©lioration d'un page de doc. (Pull Request non-encore d√©finie pour le moment, on y vient. C'est du teasing!)
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Janvier 2016, la documentation passe en Open Source
                    * indexation possible par les moteurs de recherche, suppression du login obligatoire
                    * bookmarks possibles
                    * meilleur moteur de recherche int√©gr√© au site
                </div>
                <aside class="notes">C'est un Choix d'entreprise</aside>
            </section>
            <section>
                <div data-markdown>
                    ## Tout le contenu passe sous Contr√¥le de Version: Github
                    * flux standard de contribution / revue de contenu
                    * √©crit en [markdown](https://fr.wikipedia.org/wiki/Markdown) en remplacement du ~~HTML~~.
                    * Pull Request (PR) exclusivement: norme de d√©veloppement chez Bonitasoft.
                    * la PR peut √™tre revue par J√©r√¥me, c'est notre sceau de qualit√©.
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>## Mise en pr√©-production / production automatis√©e</div>
            </section>
            <section>
                <img src="images/doc_PR_flow.png"/>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Et on vit ainsi dans un monde id√©al?
                </div>
                <div class="fragment" data-markdown>### Les effets secondaires</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## S√©paration entre contenu et pr√©sentation
                    Sur une PR: code source, sans rendu final
                    ![Github Diff](images/github_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ... m√™me si on peut voir le diff√©renciel riche
                    ![Github Diff](images/github_rich_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### toute PR d√©clenche une construction
                    sur l'environnement d'int√©gration continue
                    ![Github Diff](images/doc.rd.lan.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    * Le HTML est g√©n√©r√©
                    * le site est publi√© dans un nouveau container
                    ![Github Diff](images/Jenkins_build_result.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Tout le site est alors consultable
                    ![Github Diff](images/documentation_PR_site.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Github est notifi√© du r√©sultat du build
                    ![Github Diff](images/Github_checks.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Une notification est envoy√©e sur l'outil de messagerie
                    * chaque fois qu'une PR est cr√©√©e ou comment√©e
                    * chaque fois qu'une PR est ferm√©e (accept√©e ou refus√©e)
                    * chaque fois que la CI pousse sur la Pre-Prod / Prod
                    ![Github Diff](images/slack-doc-prod.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Mise en Production
                    Aujourd'hui, mettre en production une nouvelle version, c'est:
                    * merger une PR dans la branche 7.6
                    * attendre 2 minutes
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## B√©n√©fices visibles pour nos Personas
                    ### RICHARD
                    * doc √† jour, cycle de correction plus court
                    * une version B√™ta sort avec la doc d√©j√† √©crite
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## B√©n√©fices visibles pour nos Personas
                    ### J√âR√îME / MANU
                    * cycle tr√®s court de correction et de mise en prod de la doc
                    * historique des modifications accessible √† tous
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## B√©n√©fices visibles pour nos Personas
                    ### MANU
                    * m√™me cycle de travail que sur du code produit (Java, JS, Groovy‚Ä¶)
                    * report d‚Äôune version sur l‚Äôautre simplifi√© (`git merge`)
                </div>
                <aside class="notes" data-markdown>
                    * M√™me si pas de tests automatis√©s type JUnit
                    * Plus d'oubli de report
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## B√©n√©fices visibles pour nos Personas
                    ### J√âR√îME
                    * il s‚Äôest form√© √† Git et aux Pull Request Github
                </div>
                <aside class="notes"></aside>
            </section>

            <section title="Sous le capot">
                <div data-markdown>## Sous le capot</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### 1 build = 1 site complet
                    * g√©n√©r√© en HTML √† partir des pages .md
                    * pour chaque version du produit
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### D√©clenchement du build des PR
                    * Jenkins Organization plugin
                    * fichier Jenkinsfile commit√© dans le repository Github
                </div>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Rebuild la PR si nouveaux commits compl√©mentaires</p>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Image Docker mise √† jour. Feedbacks tr√®s courts.</p>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Publication dans un container Docker
                    * sur 1 port d√©di√© (num√©ro de la PR)
                    * m√™me cha√Æne de build que la Prod
                    * le container Docker est supprim√© si la PR est ferm√©e
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Performance
                    * PR merg√©e: dispo en prod en moins de 2 minutes
                    * rendu est identique
                    * plus de 370 PR = 370 mises en prod (depuis Janvier 2016)
                </div>
                <aside class="notes">pas de tests automatis√© type JUnit, mais m√™me cycle de W que sur du code source</aside>
            </section>
        </section>

        <section title="Engine tests on all DB vendor">
            <section>
                <h2>Lancer ses tests d'int√©gration sur diff√©rents types de base de donn√©es</h2>
                <div class="fragment">Bonita supporte Oracle, PostgreSQL, MySQL, SQL Server</div>
                <div class="fragment">h2 en mode √©mulation est rapide, mais ne valide pas la compatibilit√© sur les autres DB vendors</div>
            </section>
            <section align="center">
                <h2>Bonita doit tourner sur</h2>
                <div>
                    <img src="images/logo-mysql.png">
                    <img src="images/logo-postgresql.png">
                </div>
                <div><img src="images/logo-oracle.png" width="230px" height="230px">
                    <img src="images/logo-sqlserver.png" width="256px">
                </div>
            </section>
            <section align="center">
                <h2>Avant</h2>
                <img src="images/old_computer.jpg">

                <aside class="notes" data-markdown>
                    On d√©pendait de serveur de base de donn√©es qui devait:
                    * √™tre up
                    * avoir la bonne configuration
                    * les instances de base de donn√©es / sch√©ma devait √™tre cr√©√©es
                </aside>
            </section>

            <section>
                <div data-markdown>
                    ## Ce que nous avons mis en place
                    Utilisation d‚Äôimages docker d√©j√† tun√©es pour les bases de donn√©es support√©es:
                    * La **configuration** est d√©j√† dans l'image
                    * Les **sch√©mas** n√©cessaires sont d√©j√† dans l'image
                    * Les **users** de connexion sont d√©j√† dans l'image
                </div>
                <aside class="notes" data-markdown>
                    Config: support des transactions XA (Oracle),
                    max Prepared statement (PostgreSQL)
                </aside>
            </section>
            <section data-markdown>
                A chaque lancement des tests d'int√©gration, on lance un nouveau conteneur Docker
            </section>
            <section align="center">
                <h3>cela a rendu nos vies meilleures</h3>
                <img src="images/route_bonheur.png"/>
                <aside>

                </aside>
            </section>
            <section>
                <h2>B√©n√©fices observ√©s pour le persona "DAVE"</h2>
                <div class="fragment">Entre 20s & 1mn pour avoir une DB up & running. C‚Äôest plus rapide que d‚Äôaller voir Jeremy pour lui demander un serveur et
                    l‚Äôinstaller.
                </div>
                <div class="fragment">Aucun √©tat initial requis, on recr√©e le container √† chaque fois</div>
                <div class="fragment">√áa tourne aussi bien localement que sur une CI</div>
                <div class="fragment">Environnements plus stables</div>
                <div class="fragment">On n'a pas √† maintenir √† la main x bases de donn√©es</div>
                <div class="fragment">On n'est plus d√©pendant d‚Äôun devops / IT</div>
            </section>
            <section >
                <div>
                    <h2>Comment?</h2>

                    <p>Activation par profils maven (1 profil pour chaque DB vendor)</p>

                    <p>Utilisation d'un plugin Maven pour lancer un nouveau conteneur Docker √† partir d'une image</p>

                    <p>Idem avec plugin gradle</p>

                </div>
                <aside class="notes">
                    TODO : ref plugin gradle
                    example de code maven/gradle
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## mais encore?

                    Le plugin Maven permet de choisir un port al√©atoire. Plus de conflits de ports.

                    ![pigs rushing](images/pig_rush.jpg)

                    Docker permet d'attendre la fin r√©elle du d√©marrage du conteneur avant de lancer les tests.
                </div>
                <aside class="notes" data-markdown>HealthCheck</aside>
            </section>
            <section>
                <div data-markdown>
                    ## Limitations
                    Pas d'image docker pour MS SQL Server (compatible avec bonita) . Ces tests tournent toujours "√† l'ancienne".
                </div>
                <aside class="notes" data-markdown>
                    Transactions distribu√©es XA pas support√©es dans l'image docker SQL Server
                    contraintes peu compatible avec une int√©gration continue sur les volumes de stockage
                </aside>
            </section>
        </section>
        <section title="ICI">
            <section>
                <div>
                    <h2>ICI</h2>
                    <p>Module d'Intelligence Artificielle bas√© sur le Process Mining.</p>
                    <div class="fragment">
                        <p>Requiert:</p>
                        <ul>
                            <li>Bonita et son SGDB</li>
                            <li>Elasticsearch</li>
                            <li>add-on ICI</li>
                        </ul>
                        <p>Version "labs": 7 D√©c 2017</p>
                    </div>
                </div>

            </section>
            <section>
                <div>
                    <h2>Personas </h2>
                    <h3>Nathalie</h3>
                    <p>Product Owner et Ergonome</p>
                    <h3>Luis</h3>
                    <p>D√©veloppeur front end de la UI mobile first</p>
                    <h3>Philippe</h3>
                    <td>Sponsor du projet, Product manager</td>
                </div>
                <aside class="notes">
                    Approche User Centric Design
                </aside>
            </section>
            <section>
                <div>
                    <h2>Nouveau module,<br/> page blanche sur l'infra</h2>

                    <p class="fragment">Maven <i class=" fa fa-arrow-right"></i> Gradle & Gradle Wrapper</p>
                    <p class="fragment">YMCI <i class=" fa fa-arrow-right"></i> Jenkinsfile, Docker only
                    </p>
                    <p class="fragment">D√©ploiement <i class=" fa fa-arrow-right"></i> Docker compose</p>

                    <p class="fragment">Build tool, CI, Deploy dans le m√™me repository GIT</p>

                </div>
                <aside class="notes">
                    le√ßon apprise: on a enlev√© le deploy syst√©matique des PR. content de savoit le faire, mais inutile
                    et consommateur de ressources (8PR ouvertes = 32 container Dockers

                    ports al√©atoires publi√©s en commentaire de la pull requets sur github
                </aside>
            </section>
            <section>
                <div>
                    <h2>Master vert</h2>
                    <div class="fragment">
                        <p>4 conteneurs Docker deploy√©s sur des ports fig√©s </p>
                        <ul>
                            <li>produit releasable</li>
                            <li>base de donn√©es pr√© remplie</li>
                        </ul>
                    </div>
                    <div data-markdown class="fragment" >
                        ```
                        if (isMaster) {
                        stage('üöÄ Deploy') {
                            def deployGroovy = load "infrastructure/deploy.groovy"
                            deployGroovy.deploy([
                                bonita: 18080,
                                ici: 18082,
                                elastic: 19200,
                                database: 15432,
                                kibana: 15601
                                ],
                                currentBranch)
                        }
                        }
                        ```
                    </div>
                </div>
            </section>
            <section>
                <div>
                    <h2>Pull Request</h2>

                    <div class="fragment">
                        <p>4 container deploy√©s sur des ports al√©atoires</p>
                        <ul>
                            <li>UCDD</li>
                            <li>notification dans github</li>
                            <li>supprim√©s lorsque la PR est ferm√©e</li>

                        </ul>
                    </div>
                    <div class="fragment">
                        <p align="center">
                            <img src="images/buildPR.png">
                        </p>
                    </div>
                </div>
            </section>
            <section>
                <h2>B√©n√©fices observ√©s pour les personas</h2>
                <p>D√©mo&nbsp;<i class=" fa fa-arrow-right"></i>&nbsp;les User Stories termin√©es</p>
                <p>Tests utilisateur&nbsp;<i class=" fa fa-arrow-right"></i>&nbsp;User Story en cours (PR)</p>
            </section>

</div>
<aside class="notes">
    le√ßon apprise: on a enlev√© le deploy syst√©matique des PR. content de savoit le faire, mais inutile
    et consommateur de ressources (8PR ouvertes = 32 container Dockers

    ports al√©atoires publi√©s en commentaire de la pull requets sur github
</aside>
</section>
</section>
<section title="Conclusion">
    <section data-markdown>
        ## R√©f√©rences

        Plugin Maven Docker: [Fabric8](https://maven.fabric8.io/)
    </section>
</section>
</section>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

                // custom Bonitasoft:
                // width: "70%",
                // height: "70%",
                // margin: 0,
                // minScale: 1,
                // maxScale: 1,
                // // Si on veut que √ßa autoscroll toutes les 10s. √ßa affiche en plus un bouton Play/Pause et une spinning Wheel pour montrer le temps qui d√©file !
                // autoSlide: 10000,
                // :custom Bonitasoft

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
</script>
</body>
</html>
