<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="author" content="Laurent Leseigneur">
    <meta name="author" content="Emmanuel Duchastenier">


    <title>Agile Grenoble 2017</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/bonitasoft.css">

    <!-- for Font icons: -->
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style> .reveal i.fa { font-family:FontAwesome; font-style: normal; } </style>
</head>
<body>
<div class="reveal">
    <section class="slides">
        <section title="sponsors">
            <img src="images/Agile_Grenoble_2017_Sponsors.webp" width="860" height="620" />
        </section>
        <section title="titre" data-markdown>
            # Obtenir des feedbacks de tous vos personas plus rapidement en s’appuyant sur Docker
        </section>
        <section title="presentation speakers" data-markdown>
            ### Qui sommes nous?
            Laurent Leseigneur  
            Emmanuel Duchastenier  
            :: développeurs @ Bonitasoft
        </section>
        <!-- <section title="intro">
            <h1>Bonitasoft</h1>
            <ul>
                <li>règle N°1 : changer les règles en mode bottom-up</li>
                <li>règle N°2 : ne jamais changer la règle N°1</li>
            </ul>
        </section> -->
        <section title="glossaire">
            <section>
                <h1>Glossaire</h1>
                <h3 class="fragment current-visible">Docker</h3>
                <h3 class="fragment current-visible">Jenkins</h3>
                <h3 class="fragment current-visible">Github</h3>
                <h3 class="fragment current-visible">Pull Request</h3>
                <h3 class="fragment current-visible">Markdown</h3>
                <aside class="notes">
                   sondage bras levés
                </aside>
            </section>
            <section title="Docker" data-markdown>
                ## Docker
                ![docker infrastructure](images/docker_big_picture.png)
            </section>
        </section>

        <section title="Bonitasoft documentation website">
            <section>
                <h2>Cas d'utilisation</h2>

                <p>site public contenant la <a href="https://documentation.bonitasoft.com">documentation</a> du produit</p>
                
                <p align="center"><img src="images/Rognntudjuu.jpg">      </p>

            </section>
            <section>
                <div data-markdown>
                    ## Le problème ? la doc
                    * basée sur Drupal personnalisé par l’IT (obscur pour la R&amp;D)
                    * une seule personne met à jour la doc
                    * versioning compliqué (1 copie par version)
                    * mise en production peu fréquente (2x/an), et douloureuse
                    * accès utilisateur fermé par login
                </div>
                <aside class="notes">
                   1 version de doc par version mineure de bonita (~ 2 par an)
                </aside>
            </section>
            <section>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;On ne se sent pas propriétaire du contenu de la documentation.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Aucun report facile d’une modification sur toutes les versions supérieures. L'oubli est fréquent.</p>
                    <p><i class="fa fa-thumbs-down" aria-hidden="true"></i>&nbsp;Pas de flux de vérification : pas d'aperçu du rendu final avant sa réelle publication.</p>
            </section>
            <section data-markdown>
                ![Thinking](images/monkey_thinking.jpeg)
                ## Nécessité de changer le processus
            </section>
            <section data-markdown>
                ## Oui, mais pour qui?
                ![Personas](images/4_personas.jpg)
            </section>
            <section>
                <div data-markdown>
                ## Personas
                ### Richard
                L'utilisateur (payant / de la communauté) qui lit la doc en ligne. Il est consommateur du contenu.
                ### Manu
                Le développeur de la R&D qui maintient la doc à jour. Il est producteur de contenu.
                ### Jérôme
                Une personne du support client & un consultant qui font face aux clients perdus dans la doc. Ils sont facilitateurs pour améliorer la qualité du contenu.
                </div>
                <aside class="notes">
                    Jérôme va par exemple ouvrir un bug de doc / proposer un squelette de PR d'amélioration d'un page de doc. (Pull Request non-encore définie pour le moment, on y vient. C'est du teasing!)
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Janvier 2016, la documentation passe en Open Source
                    * indexation possible par les moteurs de recherche, suppression du login obligatoire
                    * bookmarks possibles
                    * meilleur moteur de recherche intégré au site
                </div>
                <aside class="notes">C'est un Choix d'entreprise</aside>
            </section>
            <section>
                <div data-markdown>
                    ## Tout le contenu passe sous Contrôle de Version: Github
                    * flux standard de contribution / revue de contenu
                    * écrit en [markdown](https://fr.wikipedia.org/wiki/Markdown) en remplacement du ~~HTML~~.
                    * Pull Request (PR) exclusivement: norme de développement chez Bonitasoft.
                    * la PR peut être revue par Jérôme, c'est notre sceau de qualité.
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>## Mise en pre-production / production automatisée</div>
            </section>
            <section>
                <img src="images/doc_PR_flow.png"/>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Et on vit ainsi dans un monde idéal?
                </div>
                <div class="fragment" data-markdown>### Les effets secondaires</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Séparation entre contenu et présentation
                    Sur une PR: code source, sans rendu final
                    ![Github Diff](images/github_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ... même si on peut voir le différenciel riche
                    ![Github Diff](images/github_rich_diff.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### toute PR déclenche une construction
                    sur l'environnement d'intégration continue
                    ![Github Diff](images/doc.rd.lan.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    * Le HTML est généré
                    * le site est publié dans un nouveau container
                    ![Github Diff](images/Jenkins_build_result.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Tout le site est alors consultable
                    ![Github Diff](images/documentation_PR_site.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Github est notifié du résultat du build
                    ![Github Diff](images/Github_checks.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Une notification est envoyée sur l'outil de messagerie
                    * chaque fois qu'une PR est créée ou commentée
                    * chaque fois qu'une PR est fermée (acceptée ou refusée)
                    * chaque fois que la CI pousse sur la Pre-Prod / Prod
                    ![Github Diff](images/slack-doc-prod.png)
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Mise en Production
                    Aujourd'hui, mettre en production une nouvelle version, c'est:
                    * merger une PR dans la branche 7.6
                    * attendre 2 minutes
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Bénéfices visibles pour nos Personas
                    ### RICHARD
                    * doc à jour, cycle de correction + court
                    * une version Beta sort avec la doc déjà écrite
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Bénéfices visibles pour nos Personas
                    ### JÉRÔME / MANU
                    * cycle de correction et de mise en prod de la doc, très court
                    * historique des modifications accessible à tous
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Bénéfices visibles pour nos Personas
                    ### MANU
                    * même cycle de travail que sur du code produit (Java, JS, Groovy…)
                    * report d’une version sur l’autre simplifié (`git merge`)
                </div>
                <aside class="notes" data-markdown>
                    * Même si pas de tests automatisés type JUnit
                    * Plus d'oubli de report
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## Bénéfices visibles pour nos Personas
                    ### JÉRÔME
                    * il s’est formé à Git et aux Pull Request Github
                </div>
                <aside class="notes"></aside>
            </section>

            <section title="Sous le capot">
                <div data-markdown>## Sous le capot</div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### 1 build = 1 site complet
                    * généré en HTML à partir des pages .md
                    * pour chaque version du produit
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Déclenchement du build des PR
                    * Jenkins Organization plugin
                    * fichier Jenkinsfile commité dans le repository Github
                </div>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Rebuild la PR si nouveaux commits complémentaires</p>
                <p><i class="fa fa-trophy" aria-hidden="true"></i> Image Docker mise à jour. Feedbacks très courts.</p>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ### Publication dans un container Docker
                    * sur 1 port dédié (numéro de la PR)
                    * même chaîne de build que la Prod
                    * le container Docker est supprimée si la PR est fermée
                </div>
                <aside class="notes"></aside>
            </section>
            <section>
                <div data-markdown>
                    ## Performance
                    * PR mergée: dispo en prod en - de 2 minutes
                    * le rendu est identique
                    * plus de 370 PR = 370 mises en prod (- de 2 ans)
                </div>
                <aside class="notes">pas de tests automatisé type JUnit, mais même cycle de W que sur du code source</aside>
            </section>


            <!-- MODELE -->
            <section>
                <div data-markdown>
                </div>
                <aside class="notes"></aside>
            </section>




        </section>

        <section title="Engine tests on all DB vendor">
            <section>
                <h2>Lancer ses tests d'intégration sur différents types de base de données</h2>
                <div class="fragment">Bonita supporte Oracle, PostgreSQL, MySQL, SQL Server</div>
                <div class="fragment">h2 en mode émulation est rapide, mais ne valide pas la compatibilité sur les autres DB vendors</div>
            </section>
            <section align="center">
                <h2>Bonita doit tourner sur</h2>
                <div>
                    <img src="images/logo-mysql.png">
                    <img src="images/logo-postgresql.png">
                </div>
                <div><img src="images/logo-oracle.png" width="230px" height="230px">
                    <img src="images/logo-sqlserver.png" width="256px">
                </div>
            </section>
            <section align="center">
                <h2>Avant</h2>
                <img src="images/old_computer.jpg">

                <aside class="notes" data-markdown>
                    On dépendait de serveur de base de données qui devait:
                    * être up
                    * avoir la bonne configuration
                    * les instances de base de données / schéma devait être créées
                </aside>
            </section>

            <section>
                <div data-markdown>
                    ## Ce qu'on a mis en place
                    Utilisation d’images docker déjà tunées pour les bases de donnée supportée:
                    * La **configuration** est déjà dans l'image
                    * Les **schémas** nécessaires sont déjà dans l'image
                    * Les **users** de connexion sont déjà dans l'image
                </div>
                <aside class="notes" data-markdown>
                    Config: support des transactions XA (Oracle),
                    max Prepared statement (PostgreSQL)
                </aside>
            </section>
            <section data-markdown>
                A chaque lancement des tests d'intégration, on lance un nouveau conteneur Docker
            </section>
            <section align="center">
                <h3>ça a rendu nos vies meilleurs</h3>
                <img src="images/route_bonheur.png"/>
                <aside>

                </aside>
            </section>
            <section>
                <h2>Bénéfices observés pour le persona "DAVE"</h2>
                <div class="fragment">Entre 20s & 1mn pour avoir une DB up & running. C’est plus rapide que d’aller voir Jeremy pour lui demander un serveur et
                    l’installer.
                </div>
                <div class="fragment">Aucun état initial requis, on recrée le container à chaque fois</div>
                <div class="fragment">Ça tourne aussi bien localement que sur une CI</div>
                <div class="fragment">Environnements plus stables</div>
                <div class="fragment">On n'a pas à maintenir à la main x bases de données</div>
                <div class="fragment">On n'est plus dépendant d’un devops / IT</div>
            </section>
            <section data-markdown>
                ## Comment?
                * Activation par profils maven (1 profil pour chaque DB vendor)
                * Utilisation d'un plugin Maven pour lancer un nouveau conteneur Docker à partir d'une image
                * Idem avec plugin gradle
                <aside>
                    TODO : ref plugin gradle
                    example de code maven/gradle
                </aside>
            </section>
            <section>
                <div data-markdown>
                    ## mais encore?

                    Le plugin Maven permet de choisir un port aléatoire. Plus de conflit de ports.

                    ![pigs rushing](images/pig_rush.jpg)

                    Docker permet d'attendre la fin réelle du démarrage du conteneur avant de lancer les tests.
                </div>
                <aside class="notes" data-markdown>HealthCheck</aside>
            </section>
            <section>
                <div data-markdown>
                    ## Limitations
                    Pas d'image docker pour MS SQL Server (compatible avec bonita) . Ces tests tournent toujours "à l'ancienne".
                </div>
                <aside class="notes" data-markdown>
                    Transactions distribuées XA pas supportées dans l'image docker SQL Server
                    contraintes peu compatible avec une intégration continue sur les volumes de stockage
                </aside>
            </section>
        </section>
        <section title="ICI">
            <section>
                <div>
                    <h2>ICI</h2>
                    <p>Module d'Intelligence Artificielle basé sur le Process Mining.</p>
                    <div class="fragment">
                        <p>Requiert:</p>
                        <ul>
                            <li>Bonita et son SGDB</li>
                            <li>Elasticsearch</li>
                            <li>add-on ICI</li>
                        </ul>
                        <p>Version "labs": 7 Déc 2017</p>
                    </div>
                </div>

            </section>
            <section>
                <div>
                    <h2>Personas </h2>
                    <h3>Nathalie</h3>
                    <p>Product Owner et Ergonome</p>
                    <h3>Luis</h3>
                    <p>Développeur front end de la UI mobile first</p>
                    <h3>Philippe</h3>
                    <td>Sponsor du projet, Product manager</td>
                </div>
                <aside class="notes">
                    Approche User Centric Design
                </aside>
            </section>
            <section>
                <div>
                    <h2>Nouveau module,<br/> page blanche sur l'infra</h2>

                    <p class="fragment">Maven <i class=" fa fa-arrow-right"></i> Gradle & Gradle Wrapper</p>
                    <p class="fragment">YMCI <i class=" fa fa-arrow-right"></i> Jenkinsfile, Docker only
                    </p>
                    <p class="fragment">Déploiement <i class=" fa fa-arrow-right"></i> Docker compose</p>

                    <p class="fragment">Build tool, CI, Deploy dans le même repository GIT</p>

                </div>
                <aside class="notes">
                    leçon apprise: on a enlevé le deploy systématique des PR. content de savoit le faire, mais inutile
                    et consommateur de ressources (8PR ouvertes = 32 container Dockers

                    ports aléatoires publiés en commentaire de la pull requets sur github
                </aside>
            </section>
            <section>
                <div>
                    <h2>Master vert</h2>
                    <div class="fragment">
                        <p>4 conteneurs Docker deployés sur des ports figés </p>
                        <ul>
                            <li>produit releasable</li>
                            <li>base de donnée pre remplie</li>
                        </ul>
                    </div>
                    <div data-markdown class="fragment" >
                        ```
                        if (isMaster) {
                        stage('🚀 Deploy') {
                            def deployGroovy = load "infrastructure/deploy.groovy"
                            deployGroovy.deploy([
                                bonita: 18080,
                                ici: 18082,
                                elastic: 19200,
                                database: 15432,
                                kibana: 15601
                                ],
                                currentBranch)
                        }
                        }
                        ```
                    </div>
                </div>
            </section>
            <section>
                <div>
                    <h2>Pull Request</h2>

                    <div class="fragment">
                        <p>4 container deployés sur des ports aléatoires</p>
                        <ul>
                            <li>UCDD</li>
                            <li>notification dans github</li>
                            <li>supprimés lorsque la PR est fermée</li>

                        </ul>
                    </div>
                    <div class="fragment">
                        <p align="center">
                            <img src="images/buildPR.png">
                        </p>
                    </div>
                </div>
            </section>
            <section>
                <h2>Bénéfices observés pour les personas</h2>
                <p>Démo&nbsp;<i class=" fa fa-arrow-right"></i>&nbsp;les User Stories terminées</p>
                <p>Tests utilisateur&nbsp;<i class=" fa fa-arrow-right"></i>&nbsp;User Story en cours (PR)</p>
            </section>

</div>
<aside class="notes">
    leçon apprise: on a enlevé le deploy systématique des PR. content de savoit le faire, mais inutile
    et consommateur de ressources (8PR ouvertes = 32 container Dockers

    ports aléatoires publiés en commentaire de la pull requets sur github
</aside>
</section>
</section>
<section title="Conclusion">
    <section data-markdown>
        ## Références

        Plugin Maven Docker: [Fabric8](https://maven.fabric8.io/)
    </section>
</section>
</section>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

                // custom Bonitasoft:
                // width: "70%",
                // height: "70%",
                // margin: 0,
                // minScale: 1,
                // maxScale: 1,
                // // Si on veut que ça autoscroll toutes les 10s. ça affiche en plus un bouton Play/Pause et une spinning Wheel pour montrer le temps qui défile !
                // autoSlide: 10000,
                // :custom Bonitasoft

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
</script>
</body>
</html>
